pico-8 cartridge // http://www.pico-8.com
version 16
__lua__
game=
{
	level=1,
}

function _init()
	actors:add(actor_base:new(50))
	actors:add(actor_paddle:new(100,0,0))
	actors:add(actor_paddle:new(110, 30,1))
	actors:add(actor_ball:new(0,0))
end

function _update60()
	foreach(actors,
		function(a)
			a:update()
			if (a.remove) then del(actors,a) end
		end
	)
end

function _draw()
	cls()
	drawmap()
	foreach(actors,
		function(a)
			a:draw()
		end
	)
end

function drawmap()
	if (game.level==1) then
		map(0,0,0,0)
	end
end

actors=
{
	add=function(self,a)
		add(self,a)
	end,
}

actor_base =
{
	x=0,
	y=0,
	width=8,
	height=8,
	flipx=false,
	flipy=false,
	-- sprinit=0,
	-- sprite=0,
	-- sprmax=0,
	-- sprtime=0,
	-- sprtimemax=0,
	remove=false,
	curanim="initial",
	curframe=1,
	animtick=0,

	new=function(self,x,y)
		local o = setmetatable({}, self)
		self.__index = self
		o.x = x or 0
		o.y = y or 0
		return o
	end,

	init=function(self)
		self:set_anim("initial")
	end,

	update=function(self)
		self.y+=1
		if (self:outofbounds()) then self.remove=true end
		
		--anim tick
		self.animtick-=1
		if self.animtick<=0 then
			self.curframe+=1
			local a=self.anims[self.curanim]
			self.animtick=a.ticks--reset timer
			if self.curframe>#a.frames then
				self.curframe=1--loop
			end
		end
	end,
	
	draw=function(self)
		local a=self.anims[self.curanim]
		local frame=a.frames[self.curframe]
		spr(frame,
			self.x-(self.width/2),
			self.y-(self.height/2),
			self.width/8,self.height/8,
			self.flipx,
			self.flipy)
	end,

	outofbounds=function(self)
		if ((self.x+self.width) < 0) then return true end
		if ((self.x) > 127) then return true end
		if ((self.y+self.height) < 0) then return true end
		if ((self.y) > 127) then return true end
	end,

	--animation definitions.
	--use with set_anim()
	anims=
	{
		["initial"]=
		{
			ticks=1,--how long is each frame shown.
			frames={0},--what frames are shown.
		},
	},
	
	set_anim=function(self,anim)
		if(anim==self.curanim)return--early out.
		local a=self.anims[anim]
		self.animtick=a.ticks--ticks count down.
		self.curanim=anim
		self.curframe=1
	end,
}

actor_paddle = actor_base:new()

function actor_paddle:new (x,y,playerno)
	local o = actor_base:new(x,y)
	setmetatable(o, self)
	self.__index = self
   
	o.sprinit=2
	o.sprmax=2
	o.init(o)
	o.player=playerno or 0

	self.update=function(self)
		if (btn(2,self.player)) then
			self.y-=2 end
		if (btn(3,self.player)) then
			self.y+=2 end
		actor_base.update(self)
	end

	o.anims=
	{
		["initial"]=
		{
			ticks=1,--how long is each frame shown.
			frames={16},--what frames are shown.
		},
	}

	return o
end

actor_ball = actor_base:new()

function actor_ball:new (x,y)
	local o = actor_base:new(x,y)
	setmetatable(o, self)
	self.__index = self
   
	o.sprinit=1
	o.sprmax=1
	o.init(o)

	self.update=function(self)
		self.x+=1
		actor_base.update(self)
	end

	o.anims=
	{
		["initial"]=
		{
			ticks=30,--how long is each frame shown.
			frames={1,2,3,2},--what frames are shown.
		},
	}

	return o
end

__gfx__
000000000aaaaa000aaaaa000aaaaa00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000077777777
00000000aa999aa0aa999aa0aa999aa0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000077777777
00700700a99999a0a98989a0a99899a0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000077777777
00077000a99999a0a99999a0a98989a0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000077777777
00077000a99999a0a98989a0a99899a0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000077777777
00700700aa999aa0aa999aa0aa999aa0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000077777777
000000000aaaaa000aaaaa000aaaaa00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000077777777
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000077777777
cc000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
cc000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
cc000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
cc000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
cc000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
cc000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
cc000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
cc000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__gff__
0000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
