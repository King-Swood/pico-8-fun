pico-8 cartridge // http://www.pico-8.com
version 42
__lua__
function _init()
 car1=car_make(16,10,0)
 car2=car_make(16,18,1)
end

function _update()
	car_update(car1)
	car_update(car2)
end

function _draw()
 cls()
 camera_draw()
 map_draw()
 car_draw(car1)
 car_draw(car2)
end
-->8
function car_make(x,y,p)
 local a={}
 a.p=p
 a.x=x
 a.y=y
 a.m=0
 a.slow=false
 a.a=90
 
 return a
end

function car_update(a)
 local m_max=1
 local m_inc=0.2
 local m_dec=0.1
 local r_inc=5
 
 if (btn(0,a.p)) then
  a.a-=r_inc
 end
 if (btn(1,a.p)) then
  a.a+=r_inc
 end
 if (btn(2,a.p)) then
  a.m+=m_inc
 end
 if (btn(3,a.p)) then
  a.m-=m_inc
 end
 
 if a.m>m_max then a.m=m_max
 elseif a.m<-m_max then a.m=-m_max
 end
 
 -- todo: need to use angle to work out the proportion
 --  of momentum to apply to x and y.
 a.x+=a.m
 a.y+=a.m
 
 a.slow=false
 if (tile_flag_at(a.x,a.y) & 1) == 0 then a.slow=true end
 if (tile_flag_at(a.x+7,a.y) & 1) == 0 then a.slow=true end
 if (tile_flag_at(a.x+7,a.y+7) & 1) == 0 then a.slow=true end
 if (tile_flag_at(a.x,a.y+7) & 1) == 0 then a.slow=true end
  
 if a.slow then m_dec=m_dec*3 end
 
 if a.m>m_dec then a.m-=m_dec
 elseif a.m<-m_dec then a.m+=m_dec
 else a.m=0
 end
end

function car_draw(a)
 spr_r(2,a.x,a.y,a.a,1,1)
end
-->8
function map_draw()
 map()
end

function camera_draw()
 camera(car1.x-64,car1.y-64)
end

function tile_at(x,y)
 return mget(x/8,y/8)
end

function tile_flag_at(x,y)
 return fget(tile_at(x,y))
end

-- spr_r(p.s,48,48,p.a,4,4)

--function _update()
-- if btnp(0) then p.a-=10 end
-- if btnp(1) then p.a+=10 end 
-- p.a=p.a%360 
--end

function spr_r(s,x,y,a,w,h)
 sw=(w or 1)*8
 sh=(h or 1)*8
 sx=(s%8)*8
 sy=flr(s/8)*8
 x0=flr(0.5*sw)
 y0=flr(0.5*sh)
 a=a/360
 sa=sin(a)
 ca=cos(a)
 for ix=0,sw-1 do
  for iy=0,sh-1 do
   dx=ix-x0
   dy=iy-y0
   xx=flr(dx*ca-dy*sa+x0)
   yy=flr(dx*sa+dy*ca+y0)
   if (xx>=0 and xx<sw and yy>=0 and yy<=sh) then
    local col=sget(sx+xx,sy+yy)
    if col != 0 then pset(x+ix,y+iy,col) end
   end
  end
 end
end

__gfx__
00000000666666660089880099999999000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000666666661866668190000009000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700666666661869868190000009000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000666666660869868090000009000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000666666660869868090000009000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700666666661889888190000009000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000666666661882288190000009000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000666666660022220099999999000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000006666666666660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000066666666666666000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000666666666666666600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000666666666666666600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000666666666666666600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000666666666666666600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000666666666666666600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000666666666666666600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000666666666666666600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000666666666666666600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000666666666666666600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000666666666666666600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000666666666666666600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000666666666666666600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000066666666666666000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000006666666666660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__gff__
0001000000000000000000000000000000010100000000000000000000000000000101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0011010101010101010101011200001101010101010112000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0001010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0001010000000000000000210101010122000000000101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0001010000000000000000000000000000000000000101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0001010000000000000000110101011200000000000101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0001010000000000000000010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0001010000000000000000010100210101010101010122000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0001010000000000000000010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0001010000000000000000010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0001010000000000000000010101010101010101010112000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0001010000000000000000210101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0001010000000000000000000000000000000000000101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0001010000000000000000000000000000000000000101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0001010000000000000000000000000000000000000101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0001010000000000000000000000000000000000000101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0001010000000000000000000000000000000000000101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0001010000000000000000000000000000000000000101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0001010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0021010101010101010101010101010101010101010122000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
